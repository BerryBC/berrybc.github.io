---
layout: post
title:  伍拾柒- 根据经纬度判断某范围内较高单量的目标点（外卖平台资费动态调整）
date:   2021-10-11 00:48:38 +0800
categories: 三世书记录
author: 崔秉龙
location: Guangzhou, China
---


## 一、 背景

外卖平台在动态调整各商家外送资费时，会根据往前一段时间内（一个月或一个季度），派送`距离短`的进行`减免`、`远的`进行`增收`。

故外卖平台在推广合作方案时，会优先推广`附近有大量外卖需求`的区域。

而如何根据送达经纬度来输出这些合作推广区域就是我们需要输出给销售人员信息。

## 二、经纬度处理

对经纬度进行`网格化`处理，此处参考 [Geohash](https://www.jianshu.com/p/2fd0cf12e5ba) 的部分算法。

把某城市订单数进行图形转换可得出如以下的图形（其中每点为某个经纬度，数值为指数化的外卖单数）

![某地城市](/photo/InPost/57-1.png)

## 三、需求分析

具体需求为找出所有5公里外卖`配送范围`内，覆盖单量超过`外卖单量指数`超50的中心点。


可以理解为我们需求类似 [POJ-1981 Circle and Points【单位圆覆盖最大点数】](https://blog.csdn.net/zt2650693774/article/details/99329383?utm_source=Berry)，然后输出中心点。

但算法转化为实际的问题时，我们会发现：
1. 我们的点太多，每次计算开销过于大
2. 算法并无考虑每个点权重问题

所以我们摒弃了简单的使用算法解决。

## 四、基于该坐标下的距离

绕不过的就是`距离`范围，基本我国街道都是纵横交错，所以在此问题下，我们可以引用[曼哈顿距离](https://baike.baidu.com/item/%E6%9B%BC%E5%93%88%E9%A1%BF%E8%B7%9D%E7%A6%BB)。

得到距离示例如下：

![曼哈顿距离](/photo/InPost/57-2.png)

## 五、换位思考 - 从热点找出潜力点

#### 1. 先找出肉眼能判断的点来思考逻辑

基于业务来说，外卖热点均是较为集中而不是平均分散（从第二大点的图可看出）。

从地图上看，我们的目标点如下：

![例子](/photo/InPost/57-3.png)

上图的三个例子分别
1. 例子1：每个点均不特别高，但覆盖范围内符合相应单量
2. 例子2：有一个比较高的点，只要加上另一个也相对较高的即可
3. 例子3：本来就很高了，可以框选另外一个更高的

#### 2. 所以我们目的是找出 `较高点`

我们的目的是先找出超过某单量`阈值`的点，然后再考虑这些点的范围内哪个点作为`中心点`覆盖的单量会更多。

1. 找出`超阈值点`（以20为阈值）
![点](/photo/InPost/57-4.png)
可以得到，原本的 5056 个点已经筛选出 104 个点。
2. 再找出这些点`周边`的点
![扩散](/photo/InPost/57-5.png)
当我们扩散为这些较高点的附近范围为`计算点`，需要看这些点的`范围内`是否单量总和`超条件阈值`。
3. 计算每个点看附近范围总数超阈值的点
![候选点](/photo/InPost/57-6.png)
这些是我们的输出候选点，我们可以根据参数看看是否要聚合附近的点，或者直接输出这批点。

## 六、后话

该方法只是一个测试方法，还可以通过多种调整使得更适合业务模型。

可调整的内容如：
- 初筛时候的`超阈值点`
- 初筛时的`范围`大小
- 网格范围
- 最后是否选择聚合输出